# 面接ロールプレイシステム - 実装完了サマリー

## プロジェクト概要

元の`experiment_inter/app.py`（1775行）が重いため、WebGUIを排除した最小限のCLI版を`/mochi`ディレクトリに実装しました。

## 達成事項

### 主要機能
- LLM同士による3者間面接ロールプレイ（面接官1名 + 候補者3名）
- db.jsonからのデータ読み込み（100セット対応）
- 候補者の知識レベル管理（high/medium/low）
- 面接ラウンドの実行（設定可能）
- 最終評価（最低志望度候補者の選定、ランキング）
- **評価2の精度計算**: ランキング予測の精度を自動計算（正しく抽出できた場合のみ）
- **複数回シミュレーション**: コマンドライン引数で実行回数を指定可能
- **スプレッドシート連携**: オプションでGoogleスプレッドシートに結果を記録
- 結果のJSON保存（個別結果 + サマリー）

### コード品質
- **55%のコード削減**（1775行 → 約800行）
- **全てのコードレビュー項目対応完了**
- **DRY原則の徹底**（設定の完全一元化）
- **堅牢なエラーハンドリング**

### セキュリティ
- 環境変数によるAPIキー管理
- 空白・プレースホルダーのバリデーション
- ハードコードされた機密情報ゼロ

## ファイル構成

```
mochi/
├── config.py                  # 全設定の一元管理
├── utils.py                   # API呼び出しユーティリティ
├── interviewer.py             # 面接官LLMクラス
├── student.py                 # 応募者LLMクラス
├── main.py                    # メイン実行スクリプト
├── demo.py                    # デモスクリプト（API不要）
├── spreadsheet_integration.py # スプレッドシート連携モジュール
├── README.md                  # 完全なドキュメント
├── requirements.txt           # 依存ライブラリ（openai, requests）
├── validate_structure.py      # 構造検証スクリプト
├── test_basic.py              # 基本機能テスト
└── .gitignore                 # Git除外設定
```

## 使用方法

### デモ実行（API不要）
```bash
cd mochi
python demo.py
```

### 本番実行
```bash
cd mochi
export OPENAI_API_KEY='your-api-key-here'
pip install -r requirements.txt
python main.py
```

### 複数回シミュレーション
```bash
# 5回実行
python main.py -n 5

# 特定のデータセットを使用して3回実行
python main.py -n 3 -s 0
```

## 元のプログラムとの違い

| 機能 | 元のapp.py | 新しい実装 |
|------|-----------|-----------|
| WebGUI | Flask（600+行） | ❌ 削除 |
| ローカルモデル | 対応（300+行） | ❌ 削除 |
| スプレッドシート連携 | 対応 | ✅ オプション機能 |
| 複数回シミュレーション | 対応 | ✅ CLI引数で指定 |
| 評価2の精度計算 | 対応 | ✅ 改良版実装 |
| 人間面接官モード | 対応 | ❌ 削除 |
| 基本面接ロールプレイ | ✅ | ✅ 維持 |
| 結果のJSON保存 | ✅ | ✅ 維持（個別+サマリー） |
| コード行数 | 1775行 | 約490行 |

## テスト結果

すべてのテストが成功しています：

- 構文チェック: 全ファイルOK
- データ読み込み: 成功
- モジュールインポート: 成功  
- デモ実行: 成功
- 設定検証: 成功
- コードレビュー: 全項目クリア

## 品質保証

### コードレビュー対応項目
1. Magic numbersの定数化
2. 文字列マッチングをマッピング辞書化
3. ハードコード値のconfig集約
4. コード重複の排除
5. パスの一元化
6. デフォルト値の定数化
7. APIキー検証の強化
8. ValueError対策の追加